<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIçŸ¥è¯†ç®¡ç†ç³»ç»Ÿ - é¢è¯•é¡¹ç›®æ¼”ç¤º</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; padding: 20px; 
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { 
            background: rgba(255, 255, 255, 0.95); padding: 30px; 
            border-radius: 15px; margin-bottom: 20px; 
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); 
        }
        .header h1 { color: #333; margin-bottom: 10px; font-size: 2.5em; }
        .header p { color: #666; font-size: 1.1em; }
        .dashboard { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 20px; margin-bottom: 20px; 
        }
        .card { 
            background: rgba(255, 255, 255, 0.95); padding: 25px; border-radius: 15px; 
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); 
        }
        .card h3 { 
            color: #333; margin-bottom: 15px; font-size: 1.3em; 
            border-bottom: 2px solid #667eea; padding-bottom: 8px; 
        }
        .btn {
            padding: 12px 24px; background: #667eea; color: white; 
            border: none; border-radius: 8px; font-size: 1em; cursor: pointer; 
            transition: background 0.3s;
        }
        .btn:hover { background: #5a6fd8; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        .loading { text-align: center; padding: 20px; color: #666; }
        .success { color: #4CAF50; padding: 10px; background: rgba(76, 175, 80, 0.1); border-radius: 5px; margin-top: 10px; }
        .error { color: #f44336; padding: 10px; background: rgba(244, 67, 54, 0.1); border-radius: 5px; margin-top: 10px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 500; }
        .form-group input, .form-group textarea { 
            width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; 
        }
        .form-group textarea { height: 100px; resize: vertical; }
        .status-item { display: flex; align-items: center; margin-bottom: 8px; }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; margin-right: 10px; }
        .status-online { background: #4CAF50; }
        .status-offline { background: #f44336; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§  AIçŸ¥è¯†ç®¡ç†ç³»ç»Ÿ</h1>
            <p>å…¨æ ˆAIé¡¹ç›®æ¼”ç¤º - é€‚ç”¨äºAIè½¯ä»¶å·¥ç¨‹å¸ˆé¢è¯•</p>
            <p><small>æŠ€æœ¯æ ˆ: Flask + SQLAlchemy + MySQL + Redis + AIç®—æ³• + Vue.jså‰ç«¯</small></p>
        </div>
        
        <div class="dashboard">
            <!-- ç³»ç»ŸçŠ¶æ€å¡ç‰‡ -->
            <div class="card">
                <h3>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h3>
                <div id="systemStatus">
                    <div class="loading">åŠ è½½ç³»ç»ŸçŠ¶æ€...</div>
                </div>
            </div>
            
            <!-- AIåˆ†ç±»æ¼”ç¤ºå¡ç‰‡ -->
            <div class="card">
                <h3>ğŸ¤– AIæ™ºèƒ½åˆ†ç±»</h3>
                <div class="form-group">
                    <label for="testTitle">æ ‡é¢˜:</label>
                    <input type="text" id="testTitle" placeholder="è¾“å…¥æ–‡æ¡£æ ‡é¢˜">
                </div>
                <div class="form-group">
                    <label for="testContent">å†…å®¹:</label>
                    <textarea id="testContent" placeholder="è¾“å…¥æ–‡æ¡£å†…å®¹è¿›è¡ŒAIåˆ†ç±»æµ‹è¯•..."></textarea>
                </div>
                <button class="btn" onclick="testAIClassification()">æµ‹è¯•AIåˆ†ç±»</button>
                <div id="classificationResult" style="margin-top: 15px;"></div>
            </div>
            
            <!-- åˆ›å»ºæ–‡æ¡£å¡ç‰‡ -->
            <div class="card">
                <h3>ğŸ“ åˆ›å»ºæ–‡æ¡£</h3>
                <form id="documentForm">
                    <div class="form-group">
                        <label for="docTitle">æ ‡é¢˜:</label>
                        <input type="text" id="docTitle" placeholder="è¾“å…¥æ–‡æ¡£æ ‡é¢˜" required>
                    </div>
                    <div class="form-group">
                        <label for="docContent">å†…å®¹:</label>
                        <textarea id="docContent" placeholder="è¾“å…¥æ–‡æ¡£å†…å®¹" required></textarea>
                    </div>
                    <button type="submit" class="btn" id="submitBtn">ğŸš€ åˆ›å»ºå¹¶AIå¤„ç†</button>
                </form>
                <div id="formResult"></div>
            </div>
        </div>
        
        <!-- é¡¹ç›®äº®ç‚¹å±•ç¤º -->
        <div class="card">
            <h3>ğŸ¯ é¡¹ç›®æŠ€æœ¯äº®ç‚¹</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                <div>
                    <h4>ğŸ—ï¸ ç³»ç»Ÿæ¶æ„</h4>
                    <ul style="color: #666; line-height: 1.6;">
                        <li>Flask + SQLAlchemy ORM</li>
                        <li>MySQL + Redis ç¼“å­˜</li>
                        <li>æ¨¡å—åŒ–AIæœåŠ¡è®¾è®¡</li>
                        <li>RESTful API è®¾è®¡</li>
                    </ul>
                </div>
                <div>
                    <h4>ğŸ¤– AIèƒ½åŠ›</h4>
                    <ul style="color: #666; line-height: 1.6;">
                        <li>å¤šç®—æ³•èåˆåˆ†ç±»</li>
                        <li>æ™ºèƒ½æ ‡ç­¾ç”Ÿæˆ</li>
                        <li>è¯­ä¹‰æœç´¢</li>
                        <li>å†…å®¹æ¨è</li>
                    </ul>
                </div>
                <div>
                    <h4>ğŸ”§ å·¥ç¨‹åŒ–</h4>
                    <ul style="color: #666; line-height: 1.6;">
                        <li>é”™è¯¯å¤„ç†ä¸é™çº§</li>
                        <li>æ€§èƒ½ç›‘æ§</li>
                        <li>ç¼“å­˜ç­–ç•¥</li>
                        <li>APIæ–‡æ¡£</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // APIåŸºç¡€URL
        const API_BASE = '/api/ai';
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadSystemStatus();
            
            // æ–‡æ¡£è¡¨å•æäº¤
            document.getElementById('documentForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                await createDocumentWithAI();
            });
        });
        
        // åŠ è½½ç³»ç»ŸçŠ¶æ€
        async function loadSystemStatus() {
            try {
                const response = await fetch('/api/ai/health');
                const data = await response.json();
                
                let statusHtml = '';
                if (data.overall_status === 'healthy') {
                    statusHtml += '<div class="success">âœ… æ‰€æœ‰AIæœåŠ¡è¿è¡Œæ­£å¸¸</div>';
                    statusHtml += '<div style="margin-top: 15px;">';
                    for (const [service, info] of Object.entries(data.services)) {
                        statusHtml += `<div class="status-item">
                            <div class="status-dot status-online"></div>
                            <div>${info.service}: ${info.initialized ? 'è¿è¡Œä¸­' : 'æœªåˆå§‹åŒ–'}</div>
                        </div>`;
                    }
                    statusHtml += '</div>';
                } else {
                    statusHtml = '<div class="error">âŒ AIæœåŠ¡å¼‚å¸¸</div>';
                }
                
                document.getElementById('systemStatus').innerHTML = statusHtml;
                
            } catch (error) {
                document.getElementById('systemStatus').innerHTML = 
                    '<div class="error">åŠ è½½çŠ¶æ€å¤±è´¥: ' + error.message + '</div>';
            }
        }
        
        // æµ‹è¯•AIåˆ†ç±»
        async function testAIClassification() {
            const title = document.getElementById('testTitle').value;
            const content = document.getElementById('testContent').value;
            const resultDiv = document.getElementById('classificationResult');
            
            if (!content) {
                resultDiv.innerHTML = '<div class="error">è¯·è¾“å…¥å†…å®¹è¿›è¡Œæµ‹è¯•</div>';
                return;
            }
            
            resultDiv.innerHTML = '<div class="loading">AIæ­£åœ¨åˆ†ææ–‡æœ¬...</div>';
            
            try {
                const response = await fetch(API_BASE + '/documents/classify-text', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        title: title || 'æµ‹è¯•æ–‡æ¡£',
                        text: content 
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const classification = data.classification;
                    resultDiv.innerHTML = `
                        <div class="success">
                            <strong>AIåˆ†ç±»ç»“æœ:</strong><br>
                            åˆ†ç±»: ${classification.category_name || 'æœªçŸ¥'} (ID: ${classification.category_id})<br>
                            ç½®ä¿¡åº¦: ${(classification.confidence * 100).toFixed(1)}%<br>
                            æ–¹æ³•: ${classification.method}<br>
                            è€—æ—¶: ${classification.processing_time}s
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = '<div class="error">åˆ†ç±»å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯') + '</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<div class="error">è¯·æ±‚å¤±è´¥: ' + error.message + '</div>';
            }
        }
        
        // åˆ›å»ºæ–‡æ¡£
        async function createDocumentWithAI() {
            const title = document.getElementById('docTitle').value;
            const content = document.getElementById('docContent').value;
            const submitBtn = document.getElementById('submitBtn');
            const resultDiv = document.getElementById('formResult');
            
            if (!title || !content) {
                resultDiv.innerHTML = '<div class="error">è¯·å¡«å†™æ ‡é¢˜å’Œå†…å®¹</div>';
                return;
            }
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'å¤„ç†ä¸­...';
            resultDiv.innerHTML = '<div class="loading">AIæ­£åœ¨å¤„ç†æ–‡æ¡£...</div>';
            
            try {
                const response = await fetch(API_BASE + '/documents', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title, content })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            âœ… æ–‡æ¡£åˆ›å»ºæˆåŠŸ!<br>
                            æ–‡æ¡£ID: ${data.document_id}<br>
                            AIåˆ†ç±»æ–¹æ³•: ${data.ai_processing.category_prediction.method}<br>
                            ç½®ä¿¡åº¦: ${(data.ai_processing.category_prediction.confidence * 100).toFixed(1)}%
                        </div>
                    `;
                    document.getElementById('documentForm').reset();
                } else {
                    resultDiv.innerHTML = '<div class="error">åˆ›å»ºå¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯') + '</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<div class="error">è¯·æ±‚å¤±è´¥: ' + error.message + '</div>';
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'ğŸš€ åˆ›å»ºå¹¶AIå¤„ç†';
            }
        }
        
        // æ¼”ç¤ºç”¨ä¾‹
        function loadDemoContent() {
            document.getElementById('testTitle').value = 'æœºå™¨å­¦ä¹ é¡¹ç›®æ€»ç»“';
            document.getElementById('testContent').value = 'ä»Šå¤©å®Œæˆäº†æœºå™¨å­¦ä¹ é¡¹ç›®çš„ç‰¹å¾å·¥ç¨‹å’Œæ¨¡å‹è®­ç»ƒï¼Œä½¿ç”¨äº†éšæœºæ£®æ—å’ŒXGBoostç®—æ³•ï¼Œåœ¨æµ‹è¯•é›†ä¸Šè¾¾åˆ°äº†85%çš„å‡†ç¡®ç‡ã€‚ä¸‹ä¸€æ­¥è®¡åˆ’è¿›è¡Œæ¨¡å‹ä¼˜åŒ–å’Œéƒ¨ç½²ã€‚';
        }
        
        // é¡µé¢åŠ è½½ååŠ è½½æ¼”ç¤ºå†…å®¹
        setTimeout(loadDemoContent, 1000);
    </script>
</body>
</html>
